<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MC Entity Editor Ultimate</title>
    <style>
        :root {
            --bg-color: #1e1e1e;
            --panel-bg: #252526;
            --text-color: #d4d4d4;
            --accent-color: #007acc;
            --highlight-color: #585816;
            --border-color: #3e3e42;
            --pocket-bg: #333333;
            --input-bg: #3c3c3c;
            --disabled-color: #555;
            --disabled-text: #888;
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #app {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* --- å·¦ãƒ‘ãƒãƒ« --- */
        #sidebar {
            width: 380px;
            background-color: var(--panel-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
            overflow-y: auto;
            flex-shrink: 0;
        }

        /* ãƒã‚±ãƒƒãƒˆ */
        #pocket {
            width: 100%;
            height: 80px;
            border: 2px dashed #555;
            border-radius: 8px;
            background-color: var(--pocket-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s;
            text-align: center;
            font-size: 14px;
            color: #aaa;
            flex-shrink: 0;
        }

        #pocket:hover, #pocket.dragover {
            border-color: var(--accent-color);
            color: var(--accent-color);
            background-color: #2a2d2e;
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ— */
        .control-group {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #333;
        }
        
        .control-group.disabled {
            opacity: 0.6;
        }

        .control-group label {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 13px;
        }

        .control-group .desc {
            font-size: 11px;
            color: #888;
            margin-bottom: 6px;
        }

        .status-tag {
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 2px;
            background: #444;
            font-weight: normal;
        }
        .status-tag.missing { background: #5a3030; color: #ffcccc; }
        .status-tag.added { background: #305a30; color: #ccffcc; }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 5px;
            background-color: var(--input-bg);
            border: 1px solid #555;
            color: white;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 13px;
        }

        input:disabled {
            background-color: #2a2a2a;
            border-color: #444;
            color: #666;
            cursor: not-allowed;
        }

        input:focus {
            border-color: var(--accent-color);
            outline: none;
        }

        /* åº§å¸­ã‚¨ãƒ‡ã‚£ã‚¿ */
        .seat-editor {
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 5px;
            margin-top: 5px;
        }
        .seat-item {
            display: flex;
            gap: 5px;
            margin-bottom: 5px;
            align-items: center;
        }
        .seat-item input {
            width: 33%;
            text-align: center;
        }
        .seat-label {
            font-size: 10px;
            color: #aaa;
            text-align: center;
            margin-bottom: 2px;
        }
        .btn-mini {
            background: #444;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 3px;
            padding: 2px 6px;
            font-size: 12px;
        }
        .btn-mini:hover { background: #666; }
        .btn-mini.danger { background: #843232; }
        .btn-mini.danger:hover { background: #a44242; }
        .btn-add { width: 100%; margin-top: 5px; background: #3a5a3a; }
        
        /* --- å³ãƒ‘ãƒãƒ«: ã‚³ãƒ¼ãƒ‰ãƒ“ãƒ¥ãƒ¼ --- */
        #editor-container {
            flex: 1;
            position: relative;
            background-color: #1e1e1e;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #toolbar {
            height: 40px;
            background-color: var(--panel-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 10px;
            justify-content: space-between;
            flex-shrink: 0;
        }

        #code-view {
            flex: 1;
            padding: 20px;
            overflow: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre;
            color: #d4d4d4;
            tab-size: 4;
        }

        /* ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
        .line { display: block; min-height: 1.5em; }
        .highlight {
            background-color: var(--highlight-color);
            animation: highlightFade 1.5s ease-out;
        }
        @keyframes highlightFade {
            0% { background-color: #888822; }
            100% { background-color: var(--highlight-color); }
        }

        /* ãƒ•ãƒƒã‚¿ãƒ¼ */
        footer {
            height: 30px;
            background-color: var(--panel-bg);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #888;
            flex-shrink: 0;
            z-index: 10;
        }
        footer a { color: var(--accent-color); text-decoration: none; }
        footer a:hover { text-decoration: underline; }

        /* ãƒœã‚¿ãƒ³ */
        .btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        .btn:hover { opacity: 0.9; }
        .btn.secondary { background-color: #444; }
        
        .status-badge {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 3px;
            margin-right: 10px;
            background: #333;
            color: #aaa;
        }
        .status-badge.active { background: #8e3e3e; color: white; }

    </style>
</head>
<body>

<div id="app">
    <div id="sidebar">
        <div id="pocket" title="ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—">
            ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å·¦ä¸Šã«ãƒ‰ãƒ­ãƒƒãƒ—<br>
            <span style="font-size:0.8em">(ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠ)</span>
            <input type="file" id="fileInput" accept=".json" style="display: none;">
        </div>

        <div id="parameters">
            <p style="text-align: center; color: #666; margin-top: 50px;">
                ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã¨<br>ã“ã“ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
            </p>
        </div>
    </div>

    <div id="editor-container">
        <div id="toolbar">
            <div>
                <span id="edit-status" class="status-badge">View Only</span>
                <span id="filename-display" style="font-size: 12px; color: #888;"></span>
            </div>
            <div>
                <button class="btn secondary" id="toggle-edit-btn">ç·¨é›†ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿</button>
                <button class="btn" id="download-btn">JSONã‚’ä¿å­˜</button>
            </div>
        </div>
        <div id="code-view" contenteditable="false">
            // JSONãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...
        </div>
    </div>
</div>

<footer>
    Provided by&nbsp;<a href="https://example.com" target="_blank">example.com</a>
</footer>

<script>
    // --- ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ---
    let currentData = {};
    let currentFileName = "entity.json";
    let isEditMode = false;

    // --- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š ---
    // path: JSONå†…ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¹ (componentsã‚ˆã‚Šä¸‹ã¯ç›¸å¯¾ãƒ‘ã‚¹ã§æ¢ã™ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹)
    // special: ç‰¹åˆ¥ãªå‡¦ç†ãŒå¿…è¦ãªã‚¿ã‚¤ãƒ— (seatsãªã©)
    // step: æ•°å€¤ã®å¢—æ¸›å¹…
    const paramConfig = [
        {
            id: "identifier",
            label: "ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ID",
            path: "minecraft:entity.description.identifier",
            type: "text",
            desc: "ã‚²ãƒ¼ãƒ å†…ã§ã®è­˜åˆ¥ID"
        },
        {
            id: "health",
            label: "ä½“åŠ› (Health)",
            path: "minecraft:entity.components.minecraft:health.max", // maxã‚’ç·¨é›†
            type: "number",
            step: 1,
            desc: "æœ€å¤§HP (1ãšã¤)"
        },
        {
            id: "attack",
            label: "æ”»æ’ƒåŠ› (Damage)",
            path: "minecraft:entity.components.minecraft:attack.damage",
            type: "number",
            step: 1,
            desc: "æ”»æ’ƒãƒ€ãƒ¡ãƒ¼ã‚¸ (1ãšã¤)"
        },
        {
            id: "width",
            label: "å½“ãŸã‚Šåˆ¤å®š: å¹…",
            path: "minecraft:entity.components.minecraft:collision_box.width",
            type: "number",
            step: 0.1,
            desc: "Collision Box Width"
        },
        {
            id: "height",
            label: "å½“ãŸã‚Šåˆ¤å®š: é«˜ã•",
            path: "minecraft:entity.components.minecraft:collision_box.height",
            type: "number",
            step: 0.1,
            desc: "Collision Box Height"
        },
        {
            id: "scale",
            label: "å¤§ãã• (Scale)",
            path: "minecraft:entity.components.minecraft:scale.value",
            type: "number",
            step: 0.1,
            allowAdd: true, // å­˜åœ¨ã—ãªãã¦ã‚‚è¿½åŠ å¯èƒ½
            desc: "ãƒ¢ãƒ‡ãƒ«ã®ã‚µã‚¤ã‚º (å¤§äºº/åŸºæœ¬)ã€‚ãªã‘ã‚Œã°è¿½åŠ ã—ã¾ã™ã€‚"
        },
        {
            id: "follow_range",
            label: "æ•µå¯¾/è¿½è·¡ç¯„å›²",
            path: "minecraft:entity.components.minecraft:follow_range.value",
            type: "number",
            step: 1,
            desc: "æ•µã‚’è¦‹ã¤ã‘ã‚‹è·é›¢ (Follow Range)"
        },
        {
            id: "loot",
            label: "ãƒ‰ãƒ­ãƒƒãƒ—ãƒ†ãƒ¼ãƒ–ãƒ«",
            path: "minecraft:entity.components.minecraft:loot.table",
            type: "text",
            desc: "Loot Tableã®ãƒ‘ã‚¹"
        },
        {
            id: "burst_shots",
            label: "é€£å°„æ•° (Blazeç­‰)",
            path: "minecraft:entity.components.minecraft:behavior.ranged_attack.burst_shots",
            type: "number",
            step: 1,
            desc: "1å›ã®æ”»æ’ƒã§ã®ç™ºå°„æ•°"
        },
        {
            id: "burst_interval",
            label: "æ”»æ’ƒé–“éš”/ã‚¯ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ ",
            path: "minecraft:entity.components.minecraft:behavior.ranged_attack.attack_interval", 
            // note: behaviorã«ã‚ˆã£ã¦ã¯ burst_interval ã‚„ charge_time ã®å ´åˆã‚‚ã‚ã‚‹ãŒã€ä»£è¡¨çš„ãªã‚‚ã®ã‚’æŒ‡å®š
            type: "number",
            step: 0.1,
            desc: "æ”»æ’ƒé »åº¦ (ç§’ã¾ãŸã¯Tick)"
        },
        {
            id: "seats",
            label: "åº§å¸­ä½ç½® (Rideable)",
            path: "minecraft:entity.components.minecraft:rideable",
            type: "seats", // ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¤ãƒ—
            step: 0.1,
            desc: "æ­ä¹—ä½ç½® (XYZ)ã€‚è¤‡æ•°è¨­å®šå¯ã€‚"
        }
    ];

    // --- DOMè¦ç´  ---
    const pocket = document.getElementById('pocket');
    const fileInput = document.getElementById('fileInput');
    const paramsContainer = document.getElementById('parameters');
    const codeView = document.getElementById('code-view');
    const toggleEditBtn = document.getElementById('toggle-edit-btn');
    const editStatus = document.getElementById('edit-status');
    const downloadBtn = document.getElementById('download-btn');
    const filenameDisplay = document.getElementById('filename-display');

    // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---

    // DnD & File
    pocket.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => loadFile(e.target.files[0]));
    pocket.addEventListener('dragover', (e) => { e.preventDefault(); pocket.classList.add('dragover'); });
    pocket.addEventListener('dragleave', () => pocket.classList.remove('dragover'));
    pocket.addEventListener('drop', (e) => {
        e.preventDefault();
        pocket.classList.remove('dragover');
        if (e.dataTransfer.files.length) loadFile(e.dataTransfer.files[0]);
    });

    // ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
    toggleEditBtn.addEventListener('click', () => {
        isEditMode = !isEditMode;
        codeView.contentEditable = isEditMode;
        if (isEditMode) {
            editStatus.textContent = "Editing Code";
            editStatus.classList.add('active');
            codeView.style.border = "1px solid #8e3e3e";
        } else {
            editStatus.textContent = "View Only";
            editStatus.classList.remove('active');
            codeView.style.border = "none";
            try {
                currentData = JSON.parse(codeView.innerText);
                renderControls();
                renderCode();
            } catch (e) {
                alert("JSONã‚¨ãƒ©ãƒ¼: " + e.message);
                isEditMode = true; codeView.contentEditable = true;
            }
        }
    });

    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    downloadBtn.addEventListener('click', () => {
        if (!currentData || Object.keys(currentData).length === 0) return;
        const blob = new Blob([JSON.stringify(currentData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = currentFileName; // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®ãƒ•ã‚¡ã‚¤ãƒ«å
        a.click();
        URL.revokeObjectURL(url);
    });

    // --- ãƒ­ã‚¸ãƒƒã‚¯ ---

    function loadFile(file) {
        if (!file) return;
        currentFileName = file.name;
        filenameDisplay.textContent = currentFileName;

        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                currentData = JSON.parse(e.target.result);
                renderControls();
                renderCode();
            } catch (err) {
                alert("èª­ã¿è¾¼ã¿å¤±æ•—: JSONå½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚");
            }
        };
        reader.readAsText(file);
    }

    // JSONãƒ‘ã‚¹ã‹ã‚‰å€¤ã‚’å–å¾—
    function getValueByPath(obj, path) {
        if(!obj) return undefined;
        const parts = path.split('.');
        let current = obj;
        for (const part of parts) {
            if (current === undefined || current === null) return undefined;
            current = current[part];
        }
        return current;
    }

    // JSONãƒ‘ã‚¹ã«å€¤ã‚’ã‚»ãƒƒãƒˆ (è¦ªãŒãªã„å ´åˆã¯ç°¡æ˜“ä½œæˆã—ãªã„ã€ä»Šå›ã¯æ—¢å­˜ãƒã‚§ãƒƒã‚¯æ¸ˆã¿å‰æ)
    function setValueByPath(obj, path, value) {
        const parts = path.split('.');
        let current = obj;
        // è¦ªã¾ã§ç§»å‹•
        for (let i = 0; i < parts.length - 1; i++) {
            const part = parts[i];
            if (!current[part]) {
                // scaleãªã©ã®è‡ªå‹•è¿½åŠ ç”¨: è¦ªãŒãªã‘ã‚Œã°ä½œã‚‹ç°¡æ˜“ãƒ­ã‚¸ãƒƒã‚¯
                // ãŸã ã—ä»Šå›ã¯scaleã¯componentsç›´ä¸‹ã¨ä»®å®š
                current[part] = {}; 
            }
            current = current[part];
        }
        const lastPart = parts[parts.length - 1];
        current[lastPart] = value;
        return true;
    }

    // Scaleã®ç‰¹åˆ¥è¿½åŠ å‡¦ç†
    function createScaleComponent(value) {
        // minecraft:entity -> components ã‚’æ¢ã™
        const entity = currentData["minecraft:entity"];
        if (!entity) return false;
        if (!entity.components) entity.components = {};
        
        entity.components["minecraft:scale"] = { "value": parseFloat(value) };
        return true;
    }

    // å·¦ãƒ‘ãƒãƒ«ç”Ÿæˆ
    function renderControls() {
        paramsContainer.innerHTML = '';
        if (Object.keys(currentData).length === 0) return;

        paramConfig.forEach(config => {
            let val = getValueByPath(currentData, config.path);
            const exists = (val !== undefined);
            
            // å­˜åœ¨ã›ãšã€ã‹ã¤è¿½åŠ è¨±å¯(Scale)ã§ã‚‚ãªã„å ´åˆã¯ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ
            const isDisabled = !exists && !config.allowAdd;

            const group = document.createElement('div');
            group.className = 'control-group' + (isDisabled ? ' disabled' : '');

            // ãƒ©ãƒ™ãƒ«
            const label = document.createElement('label');
            let statusHtml = '';
            if (isDisabled) statusHtml = '<span class="status-tag missing">ãªã—</span>';
            else if (!exists && config.allowAdd) statusHtml = '<span class="status-tag added">è¿½åŠ å¯èƒ½</span>';
            
            label.innerHTML = `${config.label} ${statusHtml}`;
            
            const desc = document.createElement('div');
            desc.className = 'desc';
            desc.textContent = config.desc;

            group.appendChild(label);
            group.appendChild(desc);

            // å…¥åŠ›ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
            if (config.type === 'seats') {
                // --- åº§å¸­ã‚¨ãƒ‡ã‚£ã‚¿ (ç‰¹æ®Š) ---
                if (isDisabled) {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.disabled = true;
                    input.value = "è¨­å®šãªã—";
                    group.appendChild(input);
                } else {
                    const editorDiv = document.createElement('div');
                    editorDiv.className = 'seat-editor';
                    
                    // ç¾åœ¨ã®seatsãƒ‡ãƒ¼ã‚¿ã‚’å–å¾— (Object ã‹ Array)
                    // Rideableã®ä¸­èº«: { "seats": [...] } or { "seats": {...} }
                    const rideableComp = val; // pathã¯ rideable ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè‡ªä½“ã‚’æŒ‡ã—ã¦ã„ã‚‹
                    let seatsData = rideableComp && rideableComp.seats ? rideableComp.seats : [];
                    
                    // é…åˆ—ã«çµ±ä¸€ã—ã¦å‡¦ç†
                    if (!Array.isArray(seatsData)) seatsData = [seatsData];

                    // æç”»é–¢æ•°
                    const renderSeatsList = () => {
                        editorDiv.innerHTML = '<div style="display:flex; font-size:10px; color:#aaa; margin-bottom:2px;"><span style="width:33%;text-align:center">X</span><span style="width:33%;text-align:center">Y</span><span style="width:33%;text-align:center">Z</span><span style="width:20px;"></span></div>';
                        
                        seatsData.forEach((seat, idx) => {
                            const row = document.createElement('div');
                            row.className = 'seat-item';
                            
                            const pos = seat.position || [0, 0, 0];

                            [0, 1, 2].forEach(axis => {
                                const input = document.createElement('input');
                                input.type = 'number';
                                input.step = config.step;
                                input.value = pos[axis];
                                input.addEventListener('change', (e) => {
                                    pos[axis] = parseFloat(e.target.value);
                                    // ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¦åæ˜ 
                                    seat.position = pos;
                                    // å…ƒãƒ‡ãƒ¼ã‚¿ã«æ›¸ãæˆ»ã— (Arrayã®å ´åˆã¯ãã®ã¾ã¾ã€Objectã ã£ãŸå ´åˆã¯æ§‹é€ ç¶­æŒãŒå¿…è¦ã ãŒã€ä»Šå›ã¯ArrayåŒ–ã—ã¦ä¿å­˜ã™ã‚‹ä»•æ§˜ã¨ã™ã‚‹)
                                    rideableComp.seats = seatsData;
                                    renderCode(config.path, "seats update");
                                });
                                row.appendChild(input);
                            });

                            const delBtn = document.createElement('button');
                            delBtn.textContent = 'Ã—';
                            delBtn.className = 'btn-mini danger';
                            delBtn.title = 'å‰Šé™¤';
                            delBtn.onclick = () => {
                                seatsData.splice(idx, 1);
                                rideableComp.seats = seatsData;
                                renderSeatsList();
                                renderCode(config.path, "seat removed");
                            };
                            row.appendChild(delBtn);
                            editorDiv.appendChild(row);
                        });

                        const addBtn = document.createElement('button');
                        addBtn.textContent = '+ åº§å¸­ã‚’è¿½åŠ ';
                        addBtn.className = 'btn-mini btn-add';
                        addBtn.onclick = () => {
                            seatsData.push({ position: [0, 0, 0], lock_rider_rotation: 0 });
                            rideableComp.seats = seatsData; // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«åæ˜ 
                            renderSeatsList();
                            renderCode(config.path, "seat added");
                        };
                        editorDiv.appendChild(addBtn);
                    };

                    renderSeatsList();
                    group.appendChild(editorDiv);
                }

            } else {
                // --- é€šå¸¸ã®æ•°å€¤ãƒ»ãƒ†ã‚­ã‚¹ãƒˆ ---
                const input = document.createElement('input');
                input.type = config.type;
                if (config.step) input.step = config.step;
                input.disabled = isDisabled;

                if (!exists && config.allowAdd) {
                    // è¿½åŠ å¯èƒ½ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å ´åˆï¼ˆScaleï¼‰
                    input.placeholder = "å€¤ã‚’å…¥åŠ›ã—ã¦è¿½åŠ ";
                    input.addEventListener('change', (e) => {
                        // æ–°è¦è¿½åŠ ãƒ­ã‚¸ãƒƒã‚¯
                        if (config.id === 'scale') {
                            createScaleComponent(e.target.value);
                            // å†æç”»ã—ã¦æœ‰åŠ¹åŒ–
                            renderControls(); 
                            renderCode(config.path, e.target.value);
                        }
                    });
                } else if (exists) {
                    input.value = val;
                    input.addEventListener('input', (e) => {
                        let newVal = e.target.value;
                        if (config.type === 'number') newVal = parseFloat(newVal);
                        
                        setValueByPath(currentData, config.path, newVal);
                        renderCode(config.path, newVal);
                    });
                } else {
                    input.value = "N/A"; // å­˜åœ¨ã—ãªã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
                }
                group.appendChild(input);
            }

            paramsContainer.appendChild(group);
        });
    }

    // ã‚³ãƒ¼ãƒ‰ãƒ“ãƒ¥ãƒ¼æç”»ã¨ãƒã‚¤ãƒ©ã‚¤ãƒˆ
    function renderCode(changedPath = null, changedVal = null) {
        const jsonStr = JSON.stringify(currentData, null, 2);
        codeView.innerHTML = '';
        
        const lines = jsonStr.split('\n');
        let targetElem = null;

        // ãƒã‚¤ãƒ©ã‚¤ãƒˆæ¤œç´¢ç”¨ã®ç°¡æ˜“ã‚­ãƒ¼æŠ½å‡º
        let searchKey = "";
        if (changedPath) {
            const parts = changedPath.split('.');
            // ãƒ‘ã‚¹ã®æœ€å¾Œã‚’å–å¾— (seatsã®å ´åˆã¯ rideable)
            searchKey = parts[parts.length - 1]; 
        }

        lines.forEach(line => {
            const div = document.createElement('div');
            div.className = 'line';
            div.textContent = line;

            // ç°¡æ˜“çš„ãªãƒã‚¤ãƒ©ã‚¤ãƒˆåˆ¤å®š: è¡Œå†…ã«ã‚­ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã‚Œã°ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            // æ­£ç¢ºæ€§ã‚ˆã‚Šãƒ¬ã‚¹ãƒãƒ³ã‚¹é‡è¦–
            if (changedPath && line.includes(`"${searchKey}"`)) {
                div.classList.add('highlight');
                targetElem = div;
            }
            codeView.appendChild(div);
        });

        if (targetElem) {
            setTimeout(() => targetElem.scrollIntoView({ block: 'center', behavior: 'smooth' }), 50);
        }
    }

</script>
</body>
</html>
